<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body class="bg-[#f2f2f2] flex items-center flex-col">
    <form id="submitTodo" class="w-full max-w-[500px] p-[20px] rounded bg-white shadow mt-[40px]">
        <div class="flex justify-center"><h1 class="font-bold">Add todo</h1></div>

        <div>
           <label for="todo">
            <span class="text-slate-500 text-sm">What todo today?</span>
             <input type="text" placeholder="" name="" id="text-todo" class="w-full border shadow rounded py-2 px-4" >
           </label>
           <div><input type="submit"></div>
        </div>
    </form>

    <div class="max-w-[500px] w-full p-[20px] bg-white rounded shadow border mt-6 todo-div ">
        <div class="w-full border-b-[2px] border-b-voilet-500 px-4 py-3 flex justify-between">
            <h1>this is my todo list.....</h1>
            <div class="corser">
                ...
                <div id="options" style="display: none;">
                    <button id="edit">
                        edit
                    </button>
                    <button id="delete">
                        Delete
                    </button>
                  
                </div>                
            </div>
        </div>
      
    </div>
    <script src="https://cdn.tailwindcss.com"></script>
    

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.js"></script>

    <!-- <script type="module" src="app.mjs"></script> -->
    <script>

        let eachoptions = document.querySelector("#options")
eachoptions.addEventListener("click", ()=>{

    
    eachoptions.style = ""
})

        document.querySelector("#submitTodo").addEventListener("submit",(e)=>{
            e.preventDefault()
            let postText = document.querySelector("#text-todo").value;

            // baseUrl/api/v1/post
            axios.post(`/post`, {
                text: postText
            })
                .then(function (response) {
                    console.log(response.data);
                    // getAllPost();
                })
                .catch(function (error) {
                    // handle error
                    console.log(error);
                })
                getposts()
        })

        let todos;

      
        function getposts(){
        axios.get(`/posts`)
                .then(function (response) {
                    console.log(response.data);

                     response.data.map((eachtodo)=>{

                        todos += ` <div class="w-full border-b-[2px] border-b-voilet-500 px-4 py-3 flex justify-between">
            <h1>${eachtodo.text}</h1>
            <div class="corser">
                ...
                <div style="display: none;">
                    <button onclick="delPost('${eachtodo.id}')">Delete</button>
        //                         <button onclick="editPost('${eachtodo.id}','${eachtodo.text}' )">Edit</button>
                </div>                
            </div>
        </div>`
                    })
                    document.querySelector(".todo-div").innerHTML = todos

                })
                .catch(function (error) {
                    // handle error
                    console.log(error.data);
                })
       }
        
        

   
        window.delPost = function (postId) {

            console.log("delete: ", postId);


            // baseUrl/api/v1/post
            axios.delete(`/api/v1/post/${postId}`)
                .then(function (response) {
                    console.log(response.data);

                    getAllPost();
                })
                .catch(function (error) {
                    // handle error
                    console.log(error.data);
                    document.querySelector("#result").innerHTML = "error in post submission"
                })
        }

        window.editPost = (postId, title, text) => {

            console.log("delete: ", postId);

            document.querySelector(`#card-${postId}`).innerHTML =
                `<form onsubmit="savePost('${postId}')">
                    title: <input type='text' value='${title}' id='title-${postId}' />
                    <br/>
                    text: <input type='text' value='${text}' id='text-${postId}' />
                    <br/>
                    <button>Save</button>

                </form>`
        }
        window.savePost = (postId)=>{
            const updatedTitle = document.querySelector(`#title-${postId}`).value;
            const updatedText = document.querySelector(`#text-${postId}`).value;

            axios.put(`/api/v1/post/${postId}`, {
                title: updatedTitle,
                text: updatedText
            })
                .then(function (response) {
                    console.log(response.data);
                })
                .catch(function (error) {
                    // handle error
                    console.log(error.data);
                    document.querySelector("#result").innerHTML = "error in post submission"
                })

        }



        document.addEventListener("DOMContentLoaded",()=>{
            getposts()
        })
    </script>

</body>
</html>